(()=>{"use strict";var e={565:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HTTP_METHODS=t.USERS_ROUTE_MATCHER=t.API_ROUTE_MATCHER=t.GET_USER_MATCHER=t.USER_UUID_MATCHER=void 0,t.USER_UUID_MATCHER=/^[/](users)[/]([0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12})$/,t.GET_USER_MATCHER=/^[/](users)[/]\w+/,t.API_ROUTE_MATCHER=/[/](api)[/]/,t.USERS_ROUTE_MATCHER=/[/](users)[/]?$/,t.HTTP_METHODS={get:"GET",put:"PUT",post:"POST",delete:"DELETE"}},568:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDB=void 0;const o=a(r(113)),u=i(r(1)),c=r(44);t.UserDB=class{constructor(e){this._users_database=[],this._users_database=e}setUsers(e){this._users_database=e}getAll(){return this._users_database}getOne(e){return this._users_database.find((t=>t.id===e))}updateOne(e,t){return this._users_database=this._users_database.map((r=>(r.id===e&&(t.username&&(r.username=t.username),t.age&&(r.age=t.age),t.hobbies&&(r.hobbies=t.hobbies)),r))),u.default.isWorker&&(0,c.setData)("users",this._users_database),this.getOne(e)}deleteOne(e){this._users_database=this._users_database.filter((t=>t.id!==e)).map((e=>e)),u.default.isWorker&&(0,c.setData)("users",this._users_database)}insertUser(e){e.id=o.randomUUID(),this._users_database.push(e),u.default.isWorker&&(0,c.setData)("users",this._users_database)}getSerializedUsers(){return JSON.stringify({data:this._users_database})}}},44:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setData=void 0,t.setData=(e,t)=>{process.send(JSON.stringify({action:"set",key:e,value:t}))}},338:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},i=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{u(s.next(e))}catch(e){a(e)}}function o(e){try{u(s.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.app=void 0;const o=a(r(685)),u=a(r(113)),c=new(r(568).UserDB)([]),d=r(565),l=r(771),f=r(856);process.on("message",(e=>{const t=JSON.parse(e.toString());process.stdout.write(`Updating users on worker ${process.pid}\n`),c.setUsers(t.users)})),t.app=(e=[])=>(e.length&&c.setUsers(e),o.createServer(((e,t)=>i(void 0,void 0,void 0,(function*(){t.setHeader("Access-Control-Allow-Origin","*"),console.log(`\nServer started ${process.pid}`);try{const r=yield((e,t)=>i(void 0,void 0,void 0,(function*(){const r=e.method;let s,n,a=e.url;process.stdout.write(`[INFO] REQUEST ${r} --\x3e '${a}'\n`),(e=>{e.setHeader("Content-Type","application/json")})(t),a=a.replace("/api","");const i=a.match(d.GET_USER_MATCHER),o=a.match(d.USERS_ROUTE_MATCHER);if(i&&r===d.HTTP_METHODS.get){const e=a.match(d.USER_UUID_MATCHER);if(e){const t=e[2],r=c.getOne(t);s=r?200:404,n=JSON.stringify({data:r||[]})}else s=400,n=JSON.stringify({error:"Incorrect User ID"})}else if(o&&r==d.HTTP_METHODS.get)s=200,n=(0,f.serializer)({data:c.getAll()});else if(i&&r===d.HTTP_METHODS.put){const t=a.match(d.USER_UUID_MATCHER);if(t){const r=t[2];if(c.getOne(r)){const t=yield(0,f.parseBody)(e),a=t?t.data:{},i=c.updateOne(r,a);s=200,n=(0,f.serializer)({data:i})}else s=404,n=JSON.stringify({error:"User not found"})}else s=400,n=JSON.stringify({error:"Incorrect User ID"})}else if(o&&r===d.HTTP_METHODS.post){const t=yield(0,f.parseBody)(e);if(t.data||(s=404,n=JSON.stringify({error:"Data required"})),(0,l.validateUser)(t.data)){const e=u.randomUUID(),r=Object.assign({id:e},t.data);c.insertUser(r),s=201,n=c.getSerializedUsers()}else s=400,n=JSON.stringify({error:"Please fill all required data {username: str, age: number, hobbies: array->string }"})}else if(i&&r===d.HTTP_METHODS.delete){const e=a.match(d.USER_UUID_MATCHER);if(e){const t=e[2];c.getOne(t)?(c.deleteOne(t),s=204):(s=404,n=JSON.stringify({error:"User not found"}))}else s=400,n=JSON.stringify({error:"Incorrect User ID"})}else s=404,n=JSON.stringify({error:"Requested url not found"});return{response:n,status:s}})))(e,t);console.log(r),r.status?(t.statusCode=r.status,t.end(r.response)):(t.statusCode=404,t.end(JSON.stringify({error:"Not found"})))}catch(e){t.statusCode=500,t.end(JSON.stringify({error:e.message||"Unexpected error"}))}})))))},856:function(e,t){var r=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{u(s.next(e))}catch(e){a(e)}}function o(e){try{u(s.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.parseBody=t.serializer=void 0,t.serializer=e=>JSON.stringify(e),t.parseBody=e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,r)=>{const s=[];e.on("data",(e=>s.push(e))),e.on("end",(()=>{const e=Buffer.concat(s).toString();let r={};try{r=JSON.parse(e)}catch(e){t(null)}t(r)}))}))}))},771:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateUser=void 0,t.validateUser=e=>{const{username:t,age:r,hobbies:s}=e;return!!(t&&r&&s)&&!!Array.isArray(s)}},142:e=>{e.exports=require("dotenv")},1:e=>{e.exports=require("cluster")},113:e=>{e.exports=require("crypto")},685:e=>{e.exports=require("http")}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,r),a.exports}(()=>{const e=r(338);r(142).config();const t=parseInt(process.env.PORT,10)||5e3;(0,e.app)().listen(t,"127.0.0.1",(()=>{console.log(`Server started on port ${t}`)}))})()})();